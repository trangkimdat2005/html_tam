<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="description"
        content="Vali is a responsive and free admin theme built with Bootstrap 5, SASS and PUG.js. It's fully customizable and modular." />
    <!-- Twitter meta-->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:site" content="@pratikborsadiya" />
    <meta property="twitter:creator" content="@pratikborsadiya" />
    <!-- Open Graph Meta-->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Vali Admin" />
    <meta property="og:title" content="Vali - Free Bootstrap 5 admin theme" />
    <meta property="og:url" content="http://pratikborsadiya.in/blog/vali-admin" />
    <meta property="og:image" content="http://pratikborsadiya.in/blog/vali-admin/hero-social.png" />
    <meta property="og:description"
        content="Vali is a responsive and free admin theme built with Bootstrap 5, SASS and PUG.js. It's fully customizable and modular." />
    <title>Data Table - Vali Admin</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Main CSS-->
    <link rel="stylesheet" type="text/css" href="../../admin-template/docs/css/main.css" />
    <!-- CSS riêng -->
    <link rel="stylesheet" href="../GioHang/css.css">

    <!-- Font-icon css-->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
</head>

<body class="app sidebar-mini">
    <!-- Navbar-->
    <header class="app-header">
        <a class="app-header__logo" href="index.html">Vali</a>
        <!-- Sidebar toggle button--><a class="app-sidebar__toggle" href="#" data-toggle="sidebar"
            aria-label="Hide Sidebar"></a>
        <!-- Navbar Right Menu-->
        <ul class="app-nav">
            <li class="app-search">
                <input class="app-search__input" type="search" placeholder="Search" />
                <button class="app-search__button">
                    <i class="bi bi-search"></i>
                </button>
            </li>
            <!--Notification Menu-->
            <li class="dropdown">
                <a class="app-nav__item" href="#" data-bs-toggle="dropdown" aria-label="Show notifications"><i
                        class="bi bi-bell fs-5"></i></a>
                <ul class="app-notification dropdown-menu dropdown-menu-right">
                    <li class="app-notification__title">
                        You have 4 new notifications.
                    </li>
                    <div class="app-notification__content">
                        <li>
                            <a class="app-notification__item" href="javascript:;"><span
                                    class="app-notification__icon"><i
                                        class="bi bi-envelope fs-4 text-primary"></i></span>
                                <div>
                                    <p class="app-notification__message">
                                        Lisa sent you a mail
                                    </p>
                                    <p class="app-notification__meta">2 min ago</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="app-notification__item" href="javascript:;"><span
                                    class="app-notification__icon"><i
                                        class="bi bi-exclamation-triangle fs-4 text-warning"></i></span>
                                <div>
                                    <p class="app-notification__message">
                                        Mail server not working
                                    </p>
                                    <p class="app-notification__meta">5 min ago</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="app-notification__item" href="javascript:;"><span
                                    class="app-notification__icon"><i class="bi bi-cash fs-4 text-success"></i></span>
                                <div>
                                    <p class="app-notification__message">
                                        Transaction complete
                                    </p>
                                    <p class="app-notification__meta">2 days ago</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="app-notification__item" href="javascript:;"><span
                                    class="app-notification__icon"><i
                                        class="bi bi-envelope fs-4 text-primary"></i></span>
                                <div>
                                    <p class="app-notification__message">
                                        Lisa sent you a mail
                                    </p>
                                    <p class="app-notification__meta">2 min ago</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="app-notification__item" href="javascript:;"><span
                                    class="app-notification__icon"><i
                                        class="bi bi-exclamation-triangle fs-4 text-warning"></i></span>
                                <div>
                                    <p class="app-notification__message">
                                        Mail server not working
                                    </p>
                                    <p class="app-notification__meta">5 min ago</p>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="app-notification__item" href="javascript:;"><span
                                    class="app-notification__icon"><i class="bi bi-cash fs-4 text-success"></i></span>
                                <div>
                                    <p class="app-notification__message">
                                        Transaction complete
                                    </p>
                                    <p class="app-notification__meta">2 days ago</p>
                                </div>
                            </a>
                        </li>
                    </div>
                    <li class="app-notification__footer">
                        <a href="#">See all notifications.</a>
                    </li>
                </ul>
            </li>
            <!-- User Menu-->
            <li class="dropdown">
                <a class="app-nav__item" href="#" data-bs-toggle="dropdown" aria-label="Open Profile Menu"><i
                        class="bi bi-person fs-4"></i></a>
                <ul class="dropdown-menu settings-menu dropdown-menu-right">
                    <li>
                        <a class="dropdown-item" href="page-user.html"><i class="bi bi-gear me-2 fs-5"></i> Settings</a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="page-user.html"><i class="bi bi-person me-2 fs-5"></i>
                            Profile</a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="page-login.html"><i class="bi bi-box-arrow-right me-2 fs-5"></i>
                            Logout</a>
                    </li>
                </ul>
            </li>
        </ul>
    </header>
    <!-- Sidebar menu-->
    <div class="app-sidebar__overlay" data-toggle="sidebar"></div>
    <aside class="app-sidebar">
        <div class="app-sidebar__user">
            <img class="app-sidebar__user-avatar" src="https://randomuser.me/api/portraits/men/1.jpg"
                alt="User Image" />
            <div>
                <p class="app-sidebar__user-name">John Doe</p>
                <p class="app-sidebar__user-designation">Frontend Developer</p>
            </div>
        </div>
        <ul class="app-menu">
            <li>
                <a class="app-menu__item" href="dashboard.html"><i class="app-menu__icon bi bi-speedometer"></i><span
                        class="app-menu__label">Bảng điều khiển</span></a>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-bar-chart-steps"></i><span class="app-menu__label">Quản lý hàng
                        hoá</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="quanlysanpham.html">Danh sách sản phẩm</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Quản lý danh mục</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Danh sách nhãn hiệu</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Các đơn vị</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Lịch sử giá bán</a>
                    </li>
                </ul>
            </li>

            <li>
                <a class="app-menu__item" href="#"><i class="app-menu__icon bi bi-receipt-cutoff"></i><span
                        class="app-menu__label">Danh sách hoá đơn</span></a>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi-person-circle"></i><span class="app-menu__label">Quản lý nhân
                        sự</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="quanlynhanvien.html">Danh sách nhân
                            viên</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Lịch làm việc</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Phân công ca làm việc</a>
                    </li>
                </ul>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-people"></i><span class="app-menu__label">Quản lý khách
                        hàng</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Danh sách khách hàng</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Thẻ thành viên</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Lịch sử mua hàng</a>
                    </li>
                </ul>
            </li>

            <li>
                <a class="app-menu__item" href="quanlykhuyenmai.html"><i class="app-menu__icon bi bi-percent"></i><span
                        class="app-menu__label">Quản lý khuyến mãi</span></a>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-microsoft-teams"></i><span class="app-menu__label">Quản lý nhà cung
                        cấp</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Danh sách các nhà cung cấp</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Lịch sử giao dịch</a>
                    </li>
                </ul>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-shop-window"></i><span class="app-menu__label">Quản lý kho
                        hàng</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Danh sách phiếu nhập</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Danh sách phiếu xuất</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Vị trí sản phẩm</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Danh sách hàng tồn kho</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Kiểm kê sản phẩm</a>
                    </li>
                </ul>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-building"></i><span class="app-menu__label">Phân tích & Báo
                        cáo</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Báo cáo doanh thu</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Báo cáo bán chạy</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Báo cáo tồn kho</a>
                    </li>
                </ul>
            </li>

            <li>
                <a class="app-menu__item" href="#"><i class="app-menu__icon bi bi-card-checklist"></i><span
                        class="app-menu__label">Danh sách đơn hàng</span></a>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-shield-exclamation"></i><span class="app-menu__label">Quản lý bảo
                        mật</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Tài khoản nhân viên</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Tài khoản khách hàng</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Quản lý quyền</a>
                    </li>
                </ul>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-upc-scan"></i><span class="app-menu__label">Quản lý barcode</span><i
                        class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Định danh sản phẩm</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Danh sách tem nhãn</a>
                    </li>
                </ul>
            </li>

            <li class="treeview">
                <a class="app-menu__item" href="#" data-toggle="treeview"><i
                        class="app-menu__icon bi bi-cash-coin"></i><span class="app-menu__label">Giao dịch & hoàn
                        trả</span><i class="treeview-indicator bi bi-chevron-right"></i></a>
                <ul class="treeview-menu">
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Giao dịch thanh toán</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Phiếu đổi trả</a>
                    </li>
                    <li>
                        <a class="treeview-item space-first-right-khoi" href="#">Chính sách hoàn trả</a>
                    </li>
                </ul>
            </li>

            <li>
                <a class="app-menu__item" href="#"><i class="app-menu__icon bi bi-wallet"></i><span
                        class="app-menu__label">Thanh toán</span></a>
            </li>
        </ul>
    </aside>
    <!-- PHẦN GIỎ HÀNG -->
    <main class="app-content">
        <div class="row">
            <div class="col-md-12">
                <div class="tile">
                    <div class="tile-title-w-btn">
                        <h3 class="title" style="margin-bottom: 0"><i class="bi bi-cart3 me-2"></i> Giỏ Hàng (Đơn hàng
                            POS)</h3>
                    </div>

                    <div class="tile-body">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card shadow-sm mb-3">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0 text-dark"><i class="bi bi-list-check me-2"></i> Chi Tiết Sản
                                            Phẩm (3 mặt hàng)</h5>
                                    </div>
                                    <ul class="list-group list-group-flush">

                                        <li class="list-group-item">
                                            <div class="d-flex align-items-center">

                                                <div class="d-flex flex-column flex-shrink-0 me-3 align-items-center"
                                                    style="width: 40px;">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value=""
                                                            id="item1" checked>
                                                        <label class="form-check-label" for="item1"></label>
                                                    </div>
                                                    <i
                                                        class="bi bi-box-seam fs-4 text-secondary d-none d-sm-block mt-2"></i>
                                                </div>

                                                <div
                                                    class="d-flex flex-column flex-md-row align-items-md-center justify-content-between w-100">

                                                    <div class="cart-name-details col-md-5 me-md-3">
                                                        <h6 class="mb-0 fw-bold d-inline-block">Thịt gà công nghiệp
                                                            <span class="badge bg-warning text-dark">KM</span>
                                                        </h6>
                                                        <small class="text-muted d-block mt-0 pt-0">Đơn vị: KG | Giá:
                                                            85,000 đ</small>
                                                    </div>

                                                    <div class="d-flex align-items-center col-md-3 my-auto">
                                                        <div class="cart-qty-control input-group input-group-sm">
                                                            <button class="btn btn-outline-secondary" type="button"
                                                                onclick="changeQuantity(this, -1)">-</button>
                                                            <input type="number" class="form-control text-center"
                                                                value="1" min="1" id="qty-ck001">
                                                            <button class="btn btn-outline-secondary" type="button"
                                                                onclick="changeQuantity(this, 1)">+</button>
                                                        </div>
                                                    </div>

                                                    <div class="cart-total-price text-end col-md-3 my-auto">
                                                        <p class="mb-0 fw-bold text-success">85,000 đ</p>
                                                    </div>
                                                </div>

                                                <button class="btn btn-sm btn-outline-danger ms-2 flex-shrink-0"
                                                    title="Xóa sản phẩm" onclick="removeItem(this, 'CK001')">
                                                    <i class="bi bi-x-lg"></i>
                                                </button>
                                            </div>
                                        </li>

                                        <li class="list-group-item">
                                            <div class="d-flex align-items-center">

                                                <div class="d-flex flex-column flex-shrink-0 me-3 align-items-center"
                                                    style="width: 40px;">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value=""
                                                            id="item2" checked>
                                                        <label class="form-check-label" for="item2"></label>
                                                    </div>
                                                    <i
                                                        class="bi bi-box-seam fs-4 text-secondary d-none d-sm-block mt-2"></i>
                                                </div>

                                                <div
                                                    class="d-flex flex-column flex-md-row align-items-md-center justify-content-between w-100">

                                                    <div class="cart-name-details col-md-5 me-md-3">
                                                        <h6 class="mb-0 fw-bold d-inline-block">Sữa tươi TH True Milk
                                                            (Lốc 4)</h6>
                                                        <small class="text-muted d-block mt-0 pt-0">Đơn vị: Lốc | Giá:
                                                            38,000 đ</small>
                                                    </div>

                                                    <div class="d-flex align-items-center col-md-3 my-auto">
                                                        <div class="cart-qty-control input-group input-group-sm">
                                                            <button class="btn btn-outline-secondary" type="button"
                                                                onclick="changeQuantity(this, -1)">-</button>
                                                            <input type="number" class="form-control text-center"
                                                                value="2" min="1" id="qty-st001">
                                                            <button class="btn btn-outline-secondary" type="button"
                                                                onclick="changeQuantity(this, 1)">+</button>
                                                        </div>
                                                    </div>

                                                    <div class="cart-total-price text-end col-md-3 my-auto">
                                                        <p class="mb-0 fw-bold text-success">76,000 đ</p>
                                                    </div>
                                                </div>

                                                <button class="btn btn-sm btn-outline-danger ms-2 flex-shrink-0"
                                                    title="Xóa sản phẩm" onclick="removeItem(this, 'ST001')">
                                                    <i class="bi bi-x-lg"></i>
                                                </button>
                                            </div>
                                        </li>

                                        <li class="list-group-item list-group-item-light">
                                            <div class="d-flex align-items-center text-muted">

                                                <div class="d-flex flex-column flex-shrink-0 me-3 align-items-center"
                                                    style="width: 40px;">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value=""
                                                            id="item3">
                                                        <label class="form-check-label" for="item3"></label>
                                                    </div>
                                                    <i
                                                        class="bi bi-slash-circle fs-4 text-danger d-none d-sm-block mt-2"></i>
                                                </div>

                                                <div
                                                    class="d-flex flex-column flex-md-row align-items-md-center justify-content-between w-100">

                                                    <div class="cart-name-details col-md-5 me-md-3">
                                                        <h6 class="mb-0 fw-bold text-danger d-inline-block">Cá hồi Na Uy
                                                            (Fillet) <span class="badge bg-danger">Ngừng KD</span></h6>
                                                        <small class="text-danger d-block mt-0 pt-0">Giá: 65,000 đ (Sản
                                                            phẩm không còn bán).</small>
                                                    </div>

                                                    <div class="d-flex align-items-center col-md-3 my-auto">
                                                        <div
                                                            class="cart-qty-control input-group input-group-sm text-center">
                                                            —</div>
                                                    </div>

                                                    <div class="cart-total-price text-end col-md-3 my-auto">
                                                        <p class="mb-0 text-danger text-decoration-line-through">65,000
                                                            đ</p>
                                                    </div>
                                                </div>

                                                <button class="btn btn-sm btn-outline-danger ms-2 flex-shrink-0"
                                                    title="Xóa sản phẩm" onclick="removeItem(this, 'CH002')">
                                                    <i class="bi bi-x-lg"></i>
                                                </button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i> Tóm Tắt Đơn Hàng
                                        </h5>
                                    </div>
                                    <div class="card-body">

                                        <div class="mb-3">
                                            <label class="form-label fw-bold"><i
                                                    class="bi bi-ticket-perforated me-1"></i> Mã Giảm Giá</label>
                                            <div class="input-group mb-2">
                                                <input type="text" class="form-control" placeholder="Nhập mã khuyến mãi"
                                                    id="promo-code">
                                                <button class="btn btn-outline-success" type="button"
                                                    id="apply-promo">Áp dụng</button>
                                            </div>
                                            <small id="promo-status" class="form-text text-muted">Giảm giá áp dụng trên
                                                các mặt hàng hợp lệ.</small>
                                        </div>
                                        <hr>

                                        <dl class="row mb-0">
                                            <dt class="col-8">Tạm tính ( <span id="total-items-count">2</span> sản phẩm)
                                            </dt>
                                            <dd class="col-4 text-end" id="subtotal-amount">161,000 đ</dd>

                                            <dt class="col-8 text-danger">Giảm giá (<span id="discount-code">Mã:
                                                    SALE10</span>)</dt>
                                            <dd class="col-4 text-end text-danger" id="discount-amount">- 16,100 đ</dd>

                                            <dt class="col-8 text-warning">Thuế VAT (10%)</dt>
                                            <dd class="col-4 text-end text-warning" id="vat-amount">+ 14,490 đ</dd>

                                        </dl>
                                        <hr>
                                        <dl class="row">
                                            <dt class="col-8 fs-5">Tổng cộng</dt>
                                            <dd class="col-4 text-end fs-5 text-primary fw-bold"
                                                id="total-final-amount">159,390 đ</dd>
                                        </dl>
                                    </div>
                                    <div class="card-footer d-grid">
                                        <button class="btn btn-success btn-lg" type="button" onclick="checkout()"><i
                                                class="bi bi-wallet2 me-2"></i> Thanh Toán</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    <!-- Essential javascripts for application to work-->
    <script src="../../admin-template/docs/js/jquery-3.7.0.min.js"></script>
    <script src="../../admin-template/docs/js/bootstrap.min.js"></script>
    <script src="../../admin-template/docs/js/main.js"></script>
    <!-- Page specific javascripts-->
    <link rel="stylesheet" href="https://cdn.datatables.net/v/bs5/dt-1.13.4/datatables.min.css" />
    <!-- Data table plugin-->
    <script type="text/javascript" src="../../admin-template/docs/js/plugins/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="../../admin-template/docs/js/plugins/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript">
        $("#sampleTable").DataTable();
    </script>
    <!-- Google analytics script-->
    <script type="text/javascript">
        if (document.location.hostname == "pratikborsadiya.in") {
            (function (i, s, o, g, r, a, m) {
                i["GoogleAnalyticsObject"] = r;
                (i[r] =
                    i[r] ||
                    function () {
                        (i[r].q = i[r].q || []).push(arguments);
                    }),
                    (i[r].l = 1 * new Date());
                (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m);
            })(
                window,
                document,
                "script",
                "//www.google-analytics.com/analytics.js",
                "ga"
            );
            ga("create", "UA-72504830-1", "auto");
            ga("send", "pageview");
        }
    </script>
    <!-- PHẦN GIỎ HÀNG -->
    <script type="text/javascript">
        const PRODUCT_PRICES = {
            'CK001': 85000,
            'ST001': 38000,
        };
        const VAT_RATE = 0.10;
        let appliedDiscountRate = 0.10;


        function formatCurrency(amount) {
            const numericAmount = isNaN(amount) ? 0 : amount;
            return numericAmount.toLocaleString('vi-VN') + ' đ';
        }

        function updateCartTotals() {
            let subtotal = 0;
            let itemCount = 0;

            const itemsList = document.querySelectorAll('.list-group-item');

            itemsList.forEach(item => {
                const checkbox = item.querySelector('.form-check-input');
                const qtyInput = item.querySelector('input[type="number"]');

                // Bỏ qua các mục không có ô nhập số lượng (ví dụ: sản phẩm ngừng KD)
                if (!qtyInput) return;

                // Chỉ tính toán nếu sản phẩm được CHỌN
                if (checkbox.checked) {
                    const itemId = qtyInput.id.split('-')[1].toUpperCase();
                    const quantity = parseInt(qtyInput.value) || 0;
                    const price = PRODUCT_PRICES[itemId] || 0;

                    const itemTotal = price * quantity;

                    subtotal += itemTotal;
                    itemCount += 1;

                    // Cập nhật giá trị hiển thị Thành tiền cho từng mặt hàng
                    const totalItemElement = item.querySelector('.text-end p.fw-bold');
                    if (totalItemElement) {
                        totalItemElement.textContent = formatCurrency(itemTotal);
                    }
                } else {
                    // Nếu không được chọn, đảm bảo tổng tiền hiển thị là 0
                    const totalItemElement = item.querySelector('.text-end p.fw-bold');
                    if (totalItemElement) {
                        totalItemElement.textContent = formatCurrency(0);
                    }
                }
            });

            // --- TÍNH TOÁN CUỐI CÙNG ---
            let discountAmount = subtotal * appliedDiscountRate; // Áp dụng giảm giá lên tổng tạm tính
            let netTotal = subtotal - discountAmount;
            let vatAmount = netTotal * VAT_RATE;
            let finalTotal = netTotal + vatAmount;

            // --- CẬP NHẬT GIAO DIỆN TÓM TẮT ĐƠN HÀNG ---
            $('#total-items-count').text(itemCount);
            $('#subtotal-amount').text(formatCurrency(subtotal));
            $('#discount-amount').text('- ' + formatCurrency(discountAmount));
            $('#vat-amount').text('+ ' + formatCurrency(vatAmount));
            $('#total-final-amount').text(formatCurrency(finalTotal));

            console.log("Đã tính toán lại tổng tiền giỏ hàng. Tổng cộng:", finalTotal);
        }

        // --- HÀM HÀNH ĐỘNG CỦA NGƯỜI DÙNG ---

        // Thay đổi số lượng sản phẩm
        function changeQuantity(button, delta) {
            const input = $(button).siblings('input[type="number"]');
            let currentVal = parseInt(input.val());
            let newVal = currentVal + delta;

            // Giới hạn số lượng không nhỏ hơn 1
            if (newVal >= 1) {
                input.val(newVal).trigger('change');
                // Gọi updateCartTotals sau khi thay đổi (sự kiện 'change' sẽ gọi)
            }
        }

        // Xóa sản phẩm khỏi giỏ hàng
        function removeItem(button, itemId) {
            if (confirm("Bạn có chắc chắn muốn xóa sản phẩm " + itemId + " khỏi giỏ hàng?")) {

                // 1. Gửi AJAX/Yêu cầu đến C# Backend để xóa item (Nếu cần)
                console.log("Xóa sản phẩm " + itemId + " khỏi C# Backend...");

                // 2. Xóa phần tử khỏi DOM
                $(button).closest('li').fadeOut(300, function () {
                    $(this).remove();

                    // 3. Cập nhật lại tổng tiền sau khi xóa
                    updateCartTotals();
                });
            }
        }

        // Xử lý nút Áp dụng Mã giảm giá
        function applyPromoCode() {
            const promoCode = $('#promo-code').val().trim();

            if (!promoCode) {
                $('#promo-status').text('Vui lòng nhập mã giảm giá.').removeClass('text-success').addClass('text-danger');
                return;
            }

            // TẠI ĐÂY: Thực hiện AJAX call đến C# Backend để kiểm tra mã code
            console.log(`Kiểm tra mã khuyến mãi: ${promoCode} tại Backend...`);

            // Giả lập kết quả từ Backend
            if (promoCode.toUpperCase() === 'SALE10') {
                appliedDiscountRate = 0.10; // Cập nhật mức giảm giá
                $('#discount-code').text(`Mã: ${promoCode}`);
                $('#promo-status').text('Áp dụng mã thành công (10% giảm)!').removeClass('text-danger').addClass('text-success');
            } else {
                appliedDiscountRate = 0; // Đặt lại giảm giá về 0
                $('#discount-code').text('Không có mã áp dụng');
                $('#promo-status').text('Mã không hợp lệ hoặc đã hết hạn.').removeClass('text-success').addClass('text-danger');
            }

            // Cập nhật lại tổng tiền sau khi áp dụng mã
            updateCartTotals();
        }

        // Xử lý nút Thanh Toán
        function checkout() {
            const total = parseFloat($('#total-final-amount').text().replace(/[^\d]/g, '')) || 0;

            if (total <= 0) {
                alert("Giỏ hàng rỗng hoặc tổng tiền bằng 0. Vui lòng thêm sản phẩm.");
                return;
            }

            // 1. Thu thập dữ liệu giỏ hàng, khách hàng, nhân viên, mã giảm giá.
            console.log("Chuẩn bị dữ liệu để tạo Hóa Đơn (HoaDon, ChiTietHoaDon, HoaDonKhuyenMai)");

            // 2. Gửi AJAX request đến C# Backend để tạo hóa đơn và xử lý thanh toán.
            alert(`Đang xử lý thanh toán tổng cộng: ${formatCurrency(total)}`);

            // Sau khi thành công, chuyển hướng đến trang in hóa đơn hoặc trang POS mới.
        }


        // --- KHỞI TẠO (DOCUMENT READY) ---
        $(document).ready(function () {
            // 1. Gán sự kiện cho các nút +/- (sử dụng sự kiện change trên input để kích hoạt tính toán)
            $('.list-group-item input[type="number"]').on('change', updateCartTotals);

            // 2. Gán sự kiện cho Checkbox (sử dụng sự kiện change để kích hoạt tính toán)
            $('.form-check-input').on('change', updateCartTotals);

            // 3. Gán sự kiện cho nút Áp dụng Mã giảm giá
            $('#apply-promo').on('click', applyPromoCode);

            // 4. Gán sự kiện cho nút Thanh Toán (Nếu bạn dùng button ngoài script)
            // Lưu ý: Nếu nút thanh toán có id là #checkout-btn, bạn có thể gán:
            // $('#checkout-btn').on('click', checkout); 

            // 5. Tính toán ban đầu khi trang tải xong
            updateCartTotals();
        });

    </script>
</body>

</html>